<!DOCTYPE html>
<html>

<head>
    <title>位置信息分享</title>
</head>

<body>
    <h2>分享您的位置</h2>
    <button onclick="getLocation()">共享我的位置</button>
    <p id="status"></p>
    <p id="real-location"></p>


    <script>
        function getLocation() {
            document.getElementById('status').textContent = '正在請求位置信息...';
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(sendPosition, showError);
            } else {
                document.getElementById('status').textContent = "此瀏覽器不支援地理定位。";
            }
        }

        function sendPosition(position) {
            var lat = position.coords.latitude;
            var lon = position.coords.longitude;

            fetch('https://line-bot-dd.onrender.com/receive-location', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    latitude: lat,
                    longitude: lon,
                    userId: new URLSearchParams(window.location.search).get('userId')
                })
            })
                .then(response => {
                    const contentType = response.headers.get("content-type");
                    if (!response.ok) {
                        throw new Error('網路響應不是 OK');
                    } else if (!contentType || !contentType.includes("application/json")) {
                        return response.text(); // 如果響應不是 JSON，以文本方式處理
                    }
                    return response.json();
                })
                .then(data => {
                    if (typeof data === 'string') {
                        // 如果 data 是字符串，表示響應是文本，直接顯示
                        document.getElementById('status').textContent = data;
                    } else {
                        // 否則，處理 JSON 數據
                        document.getElementById('status').textContent = '位置信息已成功發送！';
                        console.log(data);
                    }
                })
                .catch((error) => {
                    console.error('Error:', error);
                    document.getElementById('status').textContent = '發送位置信息失敗。';
                });
        }

        function showError(error) {
            switch (error.code) {
                case error.PERMISSION_DENIED:
                    document.getElementById('status').textContent = "用戶拒絕了位置請求。";
                    break;
                case error.POSITION_UNAVAILABLE:
                    document.getElementById('status').textContent = "位置信息不可用。";
                    break;
                case error.TIMEOUT:
                    document.getElementById('status').textContent = "請求用戶位置超時。";
                    break;
                case error.UNKNOWN_ERROR:
                    document.getElementById('status').textContent = "發生未知錯誤。";
                    break;
            }
        }

    </script>
</body>

</html>