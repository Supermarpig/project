<!DOCTYPE html>
<html>

<head>
    <title>位置信息分享</title>
</head>
<style>
    body {
        text-align: center;
        font-family: Arial, sans-serif;
        padding: 0 10px;
        /* 添加邊距以防止元素貼近邊緣 */
    }


    button {
        width: 300px;
        /* 設置固定寬度 */
        height: 300px;
        /* 設置固定高度 */
        line-height: 300px;
        /* 使文字垂直居中 */
        border: none;
        border-radius: 50%;
        /* 完全圓形 */
        background-color: #e4c6a1;
        color: white;
        font-size: 24px;
        cursor: pointer;
        transition: transform 0.3s;
        margin-top: 20px;
    }

    button:hover {
        transform: scale(1.2);
        /* 懸停時放大 */
    }

    #status,
    #real-location {
        margin-top: 50px;
    }

    @media (max-width: 768px) {
        button {
            padding: 12px 24px;
            font-size: 16px;
        }
    }

    @media (max-width: 480px) {
        button {
            padding: 10px 20px;
            font-size: 14px;
        }

        h2 {
            font-size: 20px;
        }
    }
</style>

<body>
    <h2>分享您的位置</h2>
    <button onclick="getLocation()">共享我的位置</button>
    <p id="status"></p>
    <p id="real-location"></p>


    <script>

        window.onload = function () {
            setTimeout(() => {
                getLocation();
            }, 1000);
        };

        function getLocation() {
            document.getElementById('status').textContent = '正在請求位置信息...';
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(sendPosition, showError);
            } else {
                document.getElementById('status').textContent = "此瀏覽器不支援地理定位。";
            }
            // 當位置共享完成後，跳轉回 LINE
            redirectToLine();
        }

        function redirectToLine() {
            // 使用 LINE 的深度鏈接來跳轉回 LINE
            // 這裡需要根據您的需求修改 URL
            window.location.href = 'line://';
        }

        function sendPosition(position) {
            var lat = position.coords.latitude;
            var lon = position.coords.longitude;

            document.getElementById('real-location').textContent = `緯度: ${lat}   , 經度: ${lon}`


            fetch('https://line-bot-dd.onrender.com/receive-location', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    latitude: lat,
                    longitude: lon,
                    userId: new URLSearchParams(window.location.search).get('userId')
                })
            })
                .then(response => {
                    const contentType = response.headers.get("content-type");
                    if (!response.ok) {
                        throw new Error('網路響應不是 OK');
                    } else if (!contentType || !contentType.includes("application/json")) {
                        return response.text(); // 如果響應不是 JSON，以文本方式處理
                    }
                    return response.json();
                })
                .then(data => {
                    if (typeof data === 'string') {
                        // 如果 data 是字符串，表示響應是文本，直接顯示
                        document.getElementById('status').textContent = data;
                    } else {
                        // 否則，處理 JSON 數據
                        document.getElementById('status').textContent = '位置信息已成功發送！';
                        console.log(data);
                    }
                })
                .catch((error) => {
                    console.error('Error:', error);
                    document.getElementById('status').textContent = '發送位置信息失敗。';
                });
        }

        function showError(error) {
            switch (error.code) {
                case error.PERMISSION_DENIED:
                    document.getElementById('status').textContent = "用戶拒絕了位置請求。";
                    break;
                case error.POSITION_UNAVAILABLE:
                    document.getElementById('status').textContent = "位置信息不可用。";
                    break;
                case error.TIMEOUT:
                    document.getElementById('status').textContent = "請求用戶位置超時。";
                    break;
                case error.UNKNOWN_ERROR:
                    document.getElementById('status').textContent = "發生未知錯誤。";
                    break;
            }
        }

    </script>
</body>

</html>